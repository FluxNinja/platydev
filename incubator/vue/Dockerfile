# ! ########################################################################### ! #
# ! #|     THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY     |# ! #
# ! ########################################################################### ! #

FROM node:14-alpine as builder
RUN npm i lerna -g --loglevel error
USER node
RUN mkdir /home/node/app
WORKDIR /home/node/app
ARG CI=true
ENV CI=$CI

COPY --chown=node:node package.json yarn.* lerna.json tsconfig.json tsconfig.build.json .eslintrc.js .eslintignore ./
#
COPY --chown=node:node incubator/vue/package.json incubator/vue/yarn.* /home/node/app/incubator/vue/
COPY --chown=node:node packages/vue-hasura-backend-plus/package.json packages/vue-hasura-backend-plus/yarn.* /home/node/app/packages/vue-hasura-backend-plus/
COPY --chown=node:node packages/humanitarian-icons/package.json packages/humanitarian-icons/yarn.* /home/node/app/packages/humanitarian-icons/
COPY --chown=node:node packages/rxdb-hasura/package.json packages/rxdb-hasura/yarn.* /home/node/app/packages/rxdb-hasura/
COPY --chown=node:node packages/vue-rxdb-hasura/package.json packages/vue-rxdb-hasura/yarn.* /home/node/app/packages/vue-rxdb-hasura/
COPY --chown=node:node packages/jsonata-schema/package.json packages/jsonata-schema/yarn.* /home/node/app/packages/jsonata-schema/

RUN yarn
#
COPY --chown=node:node incubator/vue /home/node/app/incubator/vue
COPY --chown=node:node packages/vue-hasura-backend-plus /home/node/app/packages/vue-hasura-backend-plus
COPY --chown=node:node packages/humanitarian-icons /home/node/app/packages/humanitarian-icons
COPY --chown=node:node packages/rxdb-hasura /home/node/app/packages/rxdb-hasura
COPY --chown=node:node packages/vue-rxdb-hasura /home/node/app/packages/vue-rxdb-hasura
COPY --chown=node:node packages/jsonata-schema /home/node/app/packages/jsonata-schema

# RUN yarn workspace @platyplus/incubator-vue add typescript@'<4.1' && yarn build
RUN yarn build

FROM nginx:alpine
COPY --from=builder /home/node/app/incubator/vue/dist /usr/share/nginx/html
