# Roadmap

## Step 1b: HBP Helm Charts

- [ ] HBP README: expose Hasura endpoint as well
- [ ] main website cleanup - remove charts tab and link to artifacthub
- [ ] Publish chart in awesome Hasura

## Step 2: DevTools MVP

- [ ] how to publish docker images with correct tags

  - custom skaffold builder?
  - tags: in any case, keep the published helm chart synced

  - Helm:
    - Sync somehow the version/app-version of the project chart. Ideally, bump automatically
      - According to bumps of child NPM packages? Scrappy... not conviced
        - list what changed: lerna ls --since master
      - Meanwhile, do it manually?
  - Docker:
    - build with skaffold build
      - use the set-repo option
      - with which tag policy?
    - then tag from package.json
    - (then push to docker hub, if skaffold doesn't do it already)
    - what about 'latest' tags?

- [ ] update versions in helm chart generated by devtools? Only if none or if using '\*'?
  - `platy version` in a similar way to `lerna version` - that update helm chart versions accordingly?
- [ ] monorepo config e.g.:
  - organisation name for default package names?
  - default packages directory?
  - `platy create monorepo` (create lerna, base tsconfigs, default @org/package directory, warns when something required is not installed e.g. skaffold, helm...)
- [ ] Getting started
- [ ] Hasura+HBP recipe
- [ ] CLI API documentation
- [ ] test CLI from npm installation
- [ ] attention: document the use of subdomain.localhost. Works with Chrome, but not with Firefox (etc)

## Next

- [ ] better handling of microservice name/alias
- [ ] .platy.yaml: use the k8s terminology with kind: platyplus/project, name: project name ?
- [ ] minimal package.json template - too verbose for now
- [ ] use tsdx?
- [ ] review TODOs in the code
- [x] Helm Charts repo: keep history (older chart versions) -> chartmuseum
  - [x] platydev cluster
  - [x] terraform: review + publish module
  - [ ] argocd that deploys applications (chartmuseum)
- [ ] tilehuria worker is not an http server -> allow port deactivation in the standard-service chart
- [ ] add testing to package/service/project/monorepo templates
- [ ] PostgreSql HA https://github.com/bitnami/charts/tree/master/bitnami/postgresql-ha
- [ ] Improve Helm Chart production/development values
- [ ] values.schema.json in Helm Charts
- [ ] Helm charts changes annotations. See [this example](https://github.com/artifacthub/hub/blob/master/charts/artifact-hub/Chart.yaml)

## Later

- [x] traefik/cert-manager: use a single certificate with dns challenges?
- [ ] optimise generated dockerfiles - use common layers? -> see latest skaffold release
- [ ] rabbitmq docker, helm & template?
- [ ] hasura init container: wait for postgres
- [ ] hbp init container: wait for hasura (and for minio?)
- [ ] standard init container: wait for connected services
- [ ] move templates to the root folder?
- [ ] vite template -> serviceTypeConfig.command = "yarn create {{xyz}}"
- [ ] review monorepo template
- [ ] post-install @platyplus/devtools: launch the script to check/warn dependencies -> https://www.npmjs.com/package/which
- [ ] when fetching HBP metadata/migrations:
  - git clone --filter only the required directories
  - copy only sql files of the migrations (Hasura config v1), not the yaml files (Hasura config 1)
- [ ] create shared Helm charts e.g. to generate Hasura JWT secret etc.
- [ ] for each chart of the 'charts' directory, when 'repository' starts with 'file://', automatically set the right 'version'

## Parked

- [ ] Vetur errors -> monitor the new Vetur releases
  - See: https://github.com/vuejs/vetur/issues/815
- [ ] Solve the PostgreSQL password change problem, e.g. in a pre upgrade hook batch?
  - See: https://github.com/bitnami/charts/issues/2061
- [ ] Preserve yaml comments
  - E.g. https://www.npmjs.com/package/yawn-yaml
- [ ] Include external files (Helm 3.5)
  - Install/upgrade/rollback Hasura migrations
  - Use it for HBP configuration files
  - As a result: remove Hasura & HBP dockerfiles in devtools
  - Then, move helm directory to the project directory?
  - Then, review HBP template and functionning with storage rules embedded in values.yaml
  - See: https://github.com/helm/helm/issues/3276
