# Hasura Backend Plus Helm Chart

This chart will install Postgresql, Minio, Hasura and Hasura Backend Plus (HBP).

It will also create the default traefik routes to HBP and Hasura with a valid Let's Encrypt certificate.

## TL;DR

```sh
helm repo add platydev https://charts.platy.dev
helm install my-release platydev/hasura-backend-plus
```

## Introduction

This chart bootstraps a Hasura-Backend-Plus deployment on a Kubernetes cluster using the Helm package manager. Its default installation comes with Hasura GraphQL Engine and PostgreSQL, as well as Minio. Ingress routes can be activated in enabling Traefik routes, that is ready to work with Let's Encrypt certificates and cert-manager.

## Requirements

- Kubernetes 1.12+
- Helm 3
- PV provisioner support in the underlying infrastructure (for PostgreSQL and Minio persistence)
- If activating Ingress routes:
  - Traefik, including its Custom Resource Definitions, installed on your cluster (for ingress routes)
  - DNS records pointing to your routes

## Installing the Chart

To install the chart with the release name my-release:

```sh
helm repo add platydev https://charts.platy.dev
helm install my-release platydev/hasura-backend-plus
```

The command deploys Hasura-Backend-Plus, PostgreSQL and Minio on the Kubernetes cluster in the default configuration. The [Parameters](#Parameters) and [Hasura-Backend-Plus Parameters](#) sections list the parameters that can be configured during installation.

## Uninstalling the Chart

To uninstall/delete the my-release deployment:

```sh
helm delete my-release
```

The command removes all the Kubernetes components but PVC's associated with the chart and deletes the release.

To delete the PVC's associated with my-release:

```sh
kubectl delete pvc -l release=my-release
```

Note: Deleting the PVC's will delete postgresql data as well. Please be cautious before doing it.

## Parameters

The following table lists the configurable parameters of the chart and their default values.

| Parameter                        | Description             | Default                                                            |
| -------------------------------- | ----------------------- | ------------------------------------------------------------------ |
| `global.ingress.enabled`         |                         | `false`                                                            |
| `global.ingress.tls.enabled`     |                         | `false`                                                            |
| `global.ingress.domain`          |                         | `nil`                                                              |
| `global.ingress.tls.environment` |                         | `production`                                                       |
| `imageConfig.repository`         |                         | `nhost/hasura-backend-plus`                                        |
| `imageConfig.pullPolicy`         |                         | `IfNotPresent`                                                     |
| `imageConfig.tag`                | Overrides the image tag | `latest`                                                           |
| `ingress.enabled`                |                         | `false`                                                            |
| `ingress.hosts`                  |                         | `[]`                                                               |
| `ingress.tls.enabled`            |                         | `false`                                                            |
| `ingress.tls.environment`        |                         | `production`                                                       |
| `minio.enabled`                  |                         | `true`                                                             |
| `minio.defaultBuckets`           |                         | `hasura-plus`                                                      |
| `minio.accessKey.password`       | autogenerated if none   | `nil                                                               |
| `minio.secretKey.password`       | autogenerated if none   | `nil`                                                              |
| `minio.*`                        |                         | default Charts values                                              |
| `hasura.enabled`                 |                         | `true`                                                             |
| `hasura.endpoint`                |                         | <code v-pre>http://{{ .Release.Name }}-hasura/v1/graphql</code>    |
| `hasura.adminSecret`             | autogenerated if none   | `nil`                                                              |
| `hasura.jwtSecret`               |                         | <code v-pre>{{ include "hasura-backend-plus.jwtSecret" . }}</code> |
| `hasura.*`                       |                         | default Charts values                                              |

## Hasura-Backend-Plus parameters

The following table lists the configurable Hasura-Backend-Plus parameters of the chart and their default values.

| Parameter                                    | Description                                                                                               | Default                                                                                                                      |
| -------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| `autoMigrate`                                |                                                                                                           | `true`                                                                                                                       |
| `serverUrl`                                  |                                                                                                           | `nil`                                                                                                                        |
| `storage.enabled`                            | Activates HBP storage endpoints. Requires either `minio.enabled` or `storage.external.enabled` to be true | `true`                                                                                                                       |
| `storage.rules`                              | Custom HBP [storage rules](https://nhost.github.io/hasura-backend-plus/configuration.html#storage-rules)  | `nil`([Default HBP storage rules](https://github.com/nhost/hasura-backend-plus/blob/master/custom/storage-rules/rules.yaml)) |
| `storage.external.enabled`                   |                                                                                                           | `false`                                                                                                                      |
| `storage.external.endpoint`                  |                                                                                                           | `nil`                                                                                                                        |
| `storage.external.accessKey`                 |                                                                                                           | `nil`                                                                                                                        |
| `storage.external.secretKey`                 |                                                                                                           | `nil`                                                                                                                        |
| `storage.external.bucket`                    |                                                                                                           | `hasura-plus`                                                                                                                |
| `storage.external.ssl`                       |                                                                                                           | `true`                                                                                                                       |
| `limiter.maxRequests`                        |                                                                                                           | `1000 `                                                                                                                      |
| `limiter.timeFrame`                          |                                                                                                           | `900000`                                                                                                                     |
| `emails.enabled`                             |                                                                                                           | `false`                                                                                                                      |
| `emails.smtp.host`                           |                                                                                                           | `nil`                                                                                                                        |
| `emails.smtp.port`                           |                                                                                                           | `587`                                                                                                                        |
| `emails.smtp.secure`                         |                                                                                                           | `false`                                                                                                                      |
| `emails.smtp.user`                           |                                                                                                           | `nil`                                                                                                                        |
| `emails.smtp.sender`                         |                                                                                                           | `nil`                                                                                                                        |
| `emails.smtp.authMethod`                     |                                                                                                           | `PLAIN`                                                                                                                      |
| `emails.smtp.password`                       |                                                                                                           | `nil`                                                                                                                        |
| `auth.enabled`                               |                                                                                                           | `true`                                                                                                                       |
| `auth.localUsers`                            |                                                                                                           | `true`                                                                                                                       |
| `auth.changeEmail`                           |                                                                                                           | `true`                                                                                                                       |
| `auth.notifyEmailChange`                     |                                                                                                           | `false`                                                                                                                      |
| `auth.anonymousUsers`                        |                                                                                                           | `false`                                                                                                                      |
| `auth.allowUserSelfDelete`                   |                                                                                                           | `false`                                                                                                                      |
| `auth.verifyEmails`                          |                                                                                                           | `false`                                                                                                                      |
| `auth.lostPassword`                          |                                                                                                           | `false`                                                                                                                      |
| `auth.registration.allowedEmailDomains`      |                                                                                                           | `[]`                                                                                                                         |
| `auth.registration.defaultUserRole`          |                                                                                                           | `user`                                                                                                                       |
| `auth.registration.defaultAnonymousRole`     |                                                                                                           | `anonymous`                                                                                                                  |
| `auth.registration.autoActivateNewUsers`     |                                                                                                           | `true`                                                                                                                       |
| `auth.registration.hibp`                     |                                                                                                           | `false`                                                                                                                      |
| `auth.registration.registrationCustomFields` |                                                                                                           | `[]`                                                                                                                         |
| `auth.registration.minPasswordLength`        |                                                                                                           | `3`                                                                                                                          |
| `auth.registration.defaultAllowedRoles`      |                                                                                                           | auth.registration.defaultUserRole                                                                                            |
| `auth.cookies.secret`                        | autogenerated if none                                                                                     | `nil`                                                                                                                        |
| `auth.cookies.secure`                        |                                                                                                           | `false`                                                                                                                      |
| `auth.cookies.sameSite`                      | true, false, lax, strict, none                                                                            | `lax`                                                                                                                        |
| `auth.jwt.algorithm`                         |                                                                                                           | `HS256`                                                                                                                      |
| `auth.jwt.key`                               | autogenerated if none                                                                                     | `nil`                                                                                                                        |
| `auth.jwt.claims.namespace`                  |                                                                                                           | `'https://hasura.io/jwt/claims'`                                                                                             |
| `auth.jwt.expires.in`                        |                                                                                                           | `15`                                                                                                                         |
| `auth.jwt.expires.refresh`                   |                                                                                                           | `43200`                                                                                                                      |
| `auth.jwt.customFields`                      |                                                                                                           | `[]`                                                                                                                         |
| `auth.mfa.enabled`                           |                                                                                                           | `true`                                                                                                                       |
| `auth.mfa.issuer`                            |                                                                                                           | `HBP`                                                                                                                        |
| `auth.providers.redirect.success`            |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.redirect.error`              |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.github.enabled`              |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.github.clientId`             |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.github.clientSecret`         |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.github.authenticationUrl`    |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.github.tokenUrl`             |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.github.userProfileUrl`       |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.google.enabled`              |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.google.clientId`             |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.google.clientSecret`         |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.facebook.enabled`            |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.facebook.clientId`           |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.facebook.clientSecret`       |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.linkedin.enabled`            |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.linkedin.clientId`           |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.linkedin.clientSecret`       |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.windowsLive.enabled`         |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.windowsLive.clientId`        |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.windowsLive.clientSecret`    |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.twitter.enabled`             |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.twitter.consumerKey`         |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.twitter.consumerSecret`      |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.apple.enabled`               |                                                                                                           | `false `                                                                                                                     |
| `auth.providers.apple.clientId`              |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.apple.teamId`                |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.apple.keyId`                 |                                                                                                           | `nil`                                                                                                                        |
| `auth.providers.apple.privateKey`            |                                                                                                           | `nil`                                                                                                                        |

## Configuration and installation details

### Configuring Hasura

Link to the chart for further info

### Configuring Minio/S3

Link to the chart for further info

### Securing traffic using TLS

### Use of global variables

### Expose service with Traefik Ingress

## Contribute

This chart may not fit with your needs yet, as some options may still be missing, or may need further documentation. Don't hesitate to open an issue of to ask your questions through [Discord](https://discord.gg/Bez8xY).
