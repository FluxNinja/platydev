# Hasura GraphQL Engine Helm Chart

[Hasura GraphQL Engine](https://hasura.io) is a blazing-fast GraphQL server that gives you **instant, realtime GraphQL APIs over Postgres**, with [webhook triggers](https://hub.docker.com/r/hasura/event-triggers.md) on database events, and [remote schemas](https://hub.docker.com/r/hasura/remote-schemas.md) for business logic.

## TL;DR

```sh
helm install my-release platy/hasura
```

## Introduction

This chart bootstraps a Hasura deployment on a Kubernetes cluster using the Helm package manager. It embedds a PostgreSQL database by default. Ingress routes can be activated in enabling Traefik routes, that is ready to work with Let's Encrypt certificates and cert-manager.

## Prerequisites

- Kubernetes 1.12+
- Helm 3
- PV provisioner support in the underlying infrastructure (for PostgreSQL persistence)
- If activating Ingress routes:
  - Traefik, including its Custom Resource Definitions, installed on your cluster (for ingress routes)
  - DNS records pointing to your routes

## Installing the Chart

To install the chart with the release name my-release:

```sh
helm install my-release platy/hasura
```

The command deploys Hasura and PostgreSQL on the Kubernetes cluster in the default configuration. The [Parameters](#Parameters) and [Hasura parameters](#Hasura-parameters) sections list the parameters that can be configured during installation.

## Uninstalling the Chart

To uninstall/delete the my-release deployment:

```sh
helm delete my-release
```

The command removes all the Kubernetes components but PVC's associated with the chart and deletes the release.

To delete the PVC's associated with my-release:

```sh
kubectl delete pvc -l release=my-release
```

Note: Deleting the PVC's will delete postgresql data as well. Please be cautious before doing it.

## Parameters

The following table lists the configurable parameters of the chart and their default values.

| Parameter                        | Description | Default                                           |
| -------------------------------- | ----------- | ------------------------------------------------- |
| `global.ingress.enabled`         |             | `false`                                           |
| `global.ingress.domain`          |             | `nil`                                             |
| `global.ingress.tls.enabled`     |             | `false`                                           |
| `global.ingress.tls.environment` |             | `production`                                      |
| `ingress.enabled`                |             | `false`                                           |
| `ingress.hosts`                  |             | `[]`                                              |
| `ingress.tls.enabled`            |             | `false`                                           |
| `ingress.tls.environment`        |             | `production`                                      |
| `postgresql.enabled`             |             | `true`                                            |
| `postgresql.existingSecret`      |             | <code v-pre>{{ .Release.Name }}-postgresql</code> |
| `postgresql.image.tag`           |             | `12.3.0`                                          |
| `postgresql.postgresqlDatabase`  |             | `hasura`                                          |
| `postgresql.postgresqlPassword`  | ATTENTION!  | `<secret-postgresql-password>`                    |
| `postgresql.servicePort`         |             | `5432`                                            |
| `extraEnv`                       |             | `[]`                                              |
| `imageConfig.pullPolicy`         |             | `IfNotPresent`                                    |
| `imageConfig.repository`         |             | `hasura/graphql-engine`                           |
| `imageConfig.tag`                |             | Helm chart app version                            |

## Hasura parameters

The following table lists the configurable Hasura parameters of the chart and their default values.

| Parameter                                  | Description | Default                                                   |
| ------------------------------------------ | ----------- | --------------------------------------------------------- |
| `adminInternalErrors`                      |             | `true`                                                    |
| `adminSecret`                              |             | autogenerated                                             |
| `allowList.enabled`                        |             | `false`                                                   |
| `assetsDir`                                |             | `/srv/console-assets`                                     |
| `console.enabled`                          |             | `false`                                                   |
| `cors.disable`                             |             | `false`                                                   |
| `devMode`                                  |             | `false`                                                   |
| `domain`                                   |             | `[]`                                                      |
| `enabledApis`                              |             | `['metadata', 'graphql', 'pgdump']`                       |
| `events.fetchInterval`                     |             | `3000000`                                                 |
| `events.poolSize`                          |             | `100`                                                     |
| `connect.postgresql.connections`           |             | `50`                                                      |
| `connect.postgresql.preparedStatements`    |             | `true`                                                    |
| `connect.postgresql.stringifyNumericTypes` |             | `false`                                                   |
| `connect.postgresql.stripes`               |             | `1`                                                       |
| `connect.postgresql.timeout`               |             | `100`                                                     |
| `connect.postgresql.transactionIsolation`  |             | `read-commited`                                           |
| `jwt.algorithm`                            |             | `HS256`                                                   |
| `jwt.key`                                  |             | autogenerated                                             |
| `liveQueries.multiplexedBatchSize`         |             | `100`                                                     |
| `liveQueries.multiplexedRefetchInterval`   |             | `1000`                                                    |
| `log.level`                                |             | `info`                                                    |
| `log.types`                                |             | `['startup', 'http-log', 'webhook-log', 'websocket-log']` |
| `telemetry.enabled`                        |             | `false`                                                   |
| `unauthorizedRole`                         |             | `anonymous`                                               |
| `wsReadCookie`                             |             | `false`                                                   |

## Configuration and installation details

### Configuring PostgreSQL

Link to the chart for further info

#### Changing the PostgreSQL password

Note that the Postgresql password cannot be updated through Helm once they have been set.
See Bitnami issue.

### Securing traffic using TLS

### Use of global variables

### Expose service with Traefik Ingress
